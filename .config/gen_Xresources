#!/usr/bin/env bash

set -euo pipefail

colors_file="$HOME/.config/colors"
output_file="$HOME/.Xresources"

if [ ! -f "$colors_file" ]; then
    echo "âŒ ERROR: colors file not found: $colors_file" >&2
    exit 1
fi

# Write static header
cat > "$output_file" <<'HEADER'
!! Xft
Xft.dpi: 96
Xft.antialias: true

!! Appearance
URxvt*depth: 32
URxvt.termName: rxvt-unicode-256color
URxvt.scrollBar: false

!! Font
URxvt*font: xft:DejaVu Sans Mono:size=12:hinting=true
URxvt*boldFont: xft:Source Code Pro:size=11:hinting=true
URxvt*italicFont: xft:Source Code Pro:style=Oblique:size=11:hinting=true
URxvt*boldItalicFont: xft:Source Code Pro:style=Bold Oblique:size=11:hinting=true
URxvt*letterSpace: 0

!! Colors
HEADER

translate_key() {
    case "$1" in
        COLOR_BACKGROUND) echo ".background" ;;
        COLOR_FOREGROUND) echo ".foreground" ;;
        COLOR_ACCENT0)    echo "color0" ;;
        COLOR_ACCENT1)    echo "color1" ;;
        COLOR_ACCENT2)    echo "color2" ;;
        COLOR_ACCENT3)    echo "color3" ;;
        COLOR_ACCENT4)    echo "color4" ;;
        COLOR_ACCENT5)    echo "color5" ;;
        COLOR_ACCENT6)    echo "color6" ;;
        COLOR_ACCENT7)    echo "color7" ;;
        COLOR_ACCENT8)    echo "color8" ;;
        COLOR_ACCENT9)    echo "color9" ;;
        *) echo "$1" ;;
    esac
}

while IFS= read -r line || [ -n "$line" ]; do
    line="${line#"${line%%[![:space:]]*}"}"
    [[ -z "$line" || "$line" == \#* ]] && continue

    key="${line%%=*}"
    val="${line#*=}"

    key="$(echo "$key" | tr -d '[:space:]')"
    val="$(echo "$val" | tr -d '[:space:]' | tr -d '"' | tr -d "'")"

    [[ -z "$key" || -z "$val" ]] && continue

    xkey="$(translate_key "$key")"

    echo "*${xkey}: ${val}" >> "$output_file"
done < "$colors_file"

echo "Generated $output_file and merged into Xresources."
